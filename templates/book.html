<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{title}}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <style>
    {% if not mobile %}
    #main_area {
        margin-left: 33%;
        margin-right: 33%;
    }
    {% endif %}
    </style>
</head>
<body>
<div id="main_area" style="display: inline-block;background-color: #404040;align:center;">
        {% for page in pages %}
        <img class="img lazy" data-src='/book/{{ name }}/{{ page }}' id='{{ page.replace(".","_") }}' style='display: block;margin:0 auto;width:100%;'>
        {% endfor %}
</div>
<script>
    function onEnterView(entries, observer) {
        for (let entry of entries) {
            if (entry.isIntersecting) {
                history.replaceState({}, "", "#"+entry.target.id);
                return;
            }
        }
    }
    const watcher = new IntersectionObserver(onEnterView);
    var q = [];
    function action(){
        let img = q.shift();
        function cur(){
            window.setTimeout(function(){watcher.observe(img);},5000);
            if (q.length){
                action();
            }
        }
        img.onload = cur;
        img.setAttribute('src', img.dataset.src);
        if (img.complete) cur();
    }
    function add(o){
        q.push(o);
        if (q.length == 1) window.setTimeout(function(){action();},1);
    }
    for(let o of document.querySelectorAll('img')) add(o);
</script>
</body>
</html>